-- Advance data analysis
-- By date anlysis
select 
DATE_FORMAT(order_date, '%Y-%m-01') as order_month,
sum(sales_amount) as total_sales,
count(distinct customer_key) as total_customers,
sum(quantity) as total_quantity
from gold.fact_sales
where order_date is not null
group by DATE_FORMAT(order_date, '%Y-%m-01') 
order by DATE_FORMAT(order_date, '%Y-%m-01')

-- cumulative analysis

-- calculate the total sales per month and running total sales over time
select
order_date,
total_sales,
sum(total_sales) over (order by order_date) as running_total_sales,
avg(avg_price) over (order by order_date) as moving_average_price
from
(
select
DATE_FORMAT(order_date, '%Y-%m-01') as order_date,
sum(sales_amount) as total_sales,
AVG(price) as avg_price
from gold.fact_sales
where order_date is not null
group by DATE_FORMAT(order_date, '%Y-%m-01') )t
